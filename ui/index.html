<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'">
  <title>Hivemind</title>
  <link rel="stylesheet" href="node_modules/@xterm/xterm/css/xterm.css">
  <link rel="stylesheet" href="styles/base.css">
  <link rel="stylesheet" href="styles/layout.css">
  <link rel="stylesheet" href="styles/panes.css">
  <link rel="stylesheet" href="styles/state-bar.css">
  <link rel="stylesheet" href="styles/settings-panel.css">
  <link rel="stylesheet" href="styles/friction-panel.css">
  <link rel="stylesheet" href="styles/tabs.css">
  <link rel="stylesheet" href="styles/sdk-renderer.css">
</head>
<body>
  <div class="header">
    <h1>Hivemind</h1>
    <span class="dry-run-indicator" id="dryRunIndicator" style="display: none;">DRY RUN</span>
    <div class="ci-status-indicator idle" id="ciStatusIndicator" style="display: none;">
      <span class="ci-status-icon" id="ciStatusIcon">-</span>
      <span class="ci-status-text" id="ciStatusText">CI Idle</span>
    </div>
    <!-- MC7: MCP Status Indicator -->
    <div class="mcp-status-indicator" id="mcpStatusIndicator" title="MCP connection status per agent">
      <span class="mcp-status-label">MCP</span>
      <div class="mcp-agent-dots">
        <div class="mcp-agent-dot disconnected" id="mcpDot1" data-pane="1" data-agent="Arch" title="Architect - Disconnected"></div>
        <div class="mcp-agent-dot disconnected" id="mcpDot2" data-pane="2" data-agent="Orch" title="Orchestrator - Disconnected"></div>
        <div class="mcp-agent-dot disconnected" id="mcpDot3" data-pane="3" data-agent="ImpA" title="Implementer A - Disconnected"></div>
        <div class="mcp-agent-dot disconnected" id="mcpDot4" data-pane="4" data-agent="ImpB" title="Implementer B - Disconnected"></div>
        <div class="mcp-agent-dot disconnected" id="mcpDot5" data-pane="5" data-agent="Inv" title="Investigator - Disconnected"></div>
        <div class="mcp-agent-dot disconnected" id="mcpDot6" data-pane="6" data-agent="Rev" title="Reviewer - Disconnected"></div>
      </div>
      <span class="mcp-status-summary none" id="mcpStatusSummary">0/6</span>
    </div>
    <div class="header-actions">
      <button class="btn btn-folder" id="selectProjectBtn" title="Choose project folder for all agents">Select Project</button>
      <button class="btn" id="syncBtn" title="Broadcast shared_context.md to all agents">Sync Context</button>
      <button class="btn" id="spawnAllBtn" title="Start agent CLIs in all 6 terminal panes">Spawn All Agents</button>
      <button class="btn btn-danger" id="killAllBtn" title="Terminate all running agent sessions">Kill All</button>
      <button class="btn btn-nudge" id="nudgeAllBtn" title="Send Esc+Enter to unstick churning agents">Nudge All</button>
      <button class="btn btn-fresh" id="freshStartBtn" title="Kill all sessions and start fresh without context">Fresh Start</button>
      <button class="btn btn-restart" id="fullRestartBtn" title="Shutdown cleanly (run 'npm start' to restart)">Shutdown</button>
      <button class="btn btn-friction" id="frictionBtn" title="View agent friction logs and blockers">Friction <span class="friction-count" id="frictionBadge">0</span></button>
      <span class="cost-alert-badge" id="costAlertBadge" title="Cost threshold exceeded - click to view">⚠ Cost</span>
      <button class="btn settings-btn" id="settingsBtn" title="Configure Hivemind settings and permissions">Settings</button>
      <button class="btn btn-panel" id="panelBtn" title="Toggle right panel (Screenshots, Tests, Activity, etc.)">Panel</button>
    </div>
  </div>

  <div class="settings-panel" id="settingsPanel">
    <div class="settings-section">
      <div class="settings-section-title">General</div>
      <div class="settings-grid">
        <div class="setting-item" title="Automatically start agents in all panes when Hivemind launches">
          <div class="toggle" id="toggleAutoSpawn" data-setting="autoSpawn"></div>
          <span class="setting-label">Auto-spawn agents on start</span>
        </div>
        <div class="setting-item" title="Broadcast context updates to agents when workflow state changes">
          <div class="toggle" id="toggleAutoSync" data-setting="autoSync"></div>
          <span class="setting-label">Auto-sync context on state change</span>
        </div>
        <div class="setting-item" title="Play sound when agents complete tasks or encounter errors">
          <div class="toggle" id="toggleNotifications" data-setting="notifications"></div>
          <span class="setting-label">Sound notifications</span>
        </div>
        <div class="setting-item" title="Open Chrome DevTools when Hivemind starts (for debugging)">
          <div class="toggle" id="toggleDevTools" data-setting="devTools"></div>
          <span class="setting-label">Open DevTools on start</span>
        </div>
        <div class="setting-item" title="Send sync messages to agents when workflow state changes">
          <div class="toggle active" id="toggleAgentNotify" data-setting="agentNotify"></div>
          <span class="setting-label">Notify agents on state change</span>
        </div>
        <div class="setting-item" title="Watch for file changes in workspace (triggers, context updates)">
          <div class="toggle active" id="toggleWatcher" data-setting="watcherEnabled"></div>
          <span class="setting-label">File watcher enabled</span>
        </div>
        <div class="setting-item" title="Simulate agent responses without spawning real agent instances">
          <div class="toggle" id="toggleDryRun" data-setting="dryRun"></div>
          <span class="setting-label">Dry-run mode (simulate agents)</span>
        </div>
        <div class="setting-item" title="Automatically configure MCP server for each agent on spawn">
          <div class="toggle active" id="toggleMCPAutoConfig" data-setting="mcpAutoConfig"></div>
          <span class="setting-label">Auto-configure MCP on spawn</span>
        </div>
        <div class="setting-item" title="Use Claude Agent SDK instead of PTY terminals (experimental, 4 Claude sessions)">
          <div class="toggle" id="toggleSdkMode" data-setting="sdkMode"></div>
          <span class="setting-label">SDK Mode (experimental)</span>
        </div>
      </div>
      <div class="sdk-mode-notice" id="sdkModeNotice" style="display: none; color: #4ecca3; padding: 8px 12px; background: rgba(78, 204, 163, 0.1); border-radius: 4px; margin-top: 8px;">
        ðŸš€ SDK Mode: Uses Claude Agent SDK (4 Claude sessions) for native orchestration.
      </div>
    </div>
    <div class="settings-section">
      <div class="settings-section-title">Permissions</div>
      <div class="settings-grid">
        <div class="setting-item" title="Grant all permissions without prompting (use with caution!)">
          <div class="toggle" id="toggleAllowAllPermissions" data-setting="allowAllPermissions"></div>
          <span class="setting-label">Allow All (skip prompts)</span>
        </div>
        <div class="setting-item" title="Allow agents to read files from the filesystem">
          <div class="toggle" id="toggleAllowRead" data-setting="allowRead"></div>
          <span class="setting-label">Read files</span>
        </div>
        <div class="setting-item" title="Allow agents to create and modify files">
          <div class="toggle" id="toggleAllowWrite" data-setting="allowWrite"></div>
          <span class="setting-label">Write files</span>
        </div>
        <div class="setting-item" title="Allow agents to execute shell commands (npm, git, etc.)">
          <div class="toggle" id="toggleAllowBash" data-setting="allowBash"></div>
          <span class="setting-label">Run commands</span>
        </div>
      </div>
      <div class="permissions-warning" id="permissionsWarning" style="display: none;">
        âš ï¸ "Allow All" grants full access. Only use for trusted projects.
      </div>
    </div>
    <div class="settings-section">
      <div class="settings-section-title">Cost Alerts</div>
      <div class="settings-grid">
        <div class="setting-item" title="Show warning when estimated session cost exceeds threshold">
          <div class="toggle active" id="toggleCostAlertEnabled" data-setting="costAlertEnabled"></div>
          <span class="setting-label">Enable cost alerts</span>
        </div>
      </div>
      <div class="cost-threshold-setting" title="Dollar amount that triggers a cost warning">
        <label class="setting-label">Alert threshold: $</label>
        <input type="number" id="costAlertThreshold" class="threshold-input" value="5.00" min="0.01" step="0.50" title="Estimated cost limit before warning">
      </div>
    </div>
  </div>

  <div class="friction-panel" id="frictionPanel">
    <div class="friction-header">
      <span class="friction-title" title="Issues and blockers reported by agents">Friction Logs</span>
      <div class="friction-actions">
        <button class="btn btn-friction" id="refreshFrictionBtn" title="Reload friction logs from workspace">Refresh</button>
        <button class="btn btn-friction" id="clearFrictionBtn" title="Delete all resolved friction logs">Clear Resolved</button>
      </div>
    </div>
    <div class="friction-list" id="frictionList">
      <div class="friction-empty">No friction logs found</div>
    </div>
  </div>

  <div class="state-bar">
    <div class="project-indicator" title="Current project folder for all agents">
      <span class="state-label">Project:</span>
      <span class="project-path no-project" id="projectPath">No project selected</span>
    </div>
    <div class="state-indicator" title="Current workflow state: idle â†’ planning â†’ executing â†’ complete">
      <span class="state-label">State:</span>
      <span class="state-value idle" id="stateDisplay">IDLE</span>
    </div>
    <div class="progress-indicator" title="Checkpoint progress through current sprint">
      <span class="state-label">Progress:</span>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
      </div>
      <span class="progress-text" id="progressText">0 / 0</span>
    </div>
  </div>

  <div class="main-content">
    <div class="terminals-section" id="terminalsSection">
      <div class="pane-grid">
        <div class="pane" data-pane-id="1">
          <div class="pane-header">
            <span class="pane-title"><span class="agent-avatar">ðŸ‘‘</span><span class="agent-badge idle" id="badge-1"></span>Architect<span class="cli-badge" id="cli-badge-1"></span><span class="pane-project" id="project-1" title="Click to change project"></span><span class="agent-task" id="task-1"></span></span>
            <div class="pane-header-right">
              <span class="pane-timer" id="timer-1" title="Session time">0:00</span>
              <span class="sdk-status disconnected" id="sdk-status-1" title="SDK session status">â€”</span>
              <span class="sdk-session-id" id="sdk-session-1" title="Session ID"></span>
              <span class="pane-status" id="status-1">Ready</span>
              <span class="agent-health" id="health-1" title="Last output time">-</span>
              <span class="stuck-indicator" id="stuck-1" title="Agent may be stuck">⚠</span>
              <span class="delivery-indicator" id="delivery-1" title="Message delivery status"></span>
              <div class="pane-actions">
                <button class="pane-action-btn interrupt-btn" data-pane-id="1" title="Send Ctrl+C (interrupt)">⊘</button>
                <button class="pane-action-btn unstick-btn" data-pane-id="1" title="Send ESC (unstick)">⎋</button>
              </div>
              <button class="pane-refresh-btn" data-pane-id="1" title="Refresh context">↻</button>
            </div>
          </div>
          <div class="pane-terminal" id="terminal-1"></div>
        </div>

        <div class="pane" data-pane-id="2">
          <div class="pane-header">
            <span class="pane-title"><span class="agent-avatar">ðŸ§­</span><span class="agent-badge idle" id="badge-2"></span>Orchestrator<span class="cli-badge" id="cli-badge-2"></span><span class="pane-project" id="project-2" title="Click to change project"></span><span class="agent-task" id="task-2"></span></span>
            <div class="pane-header-right">
              <span class="pane-timer" id="timer-2" title="Session time">0:00</span>
              <span class="sdk-status disconnected" id="sdk-status-2" title="SDK session status">â€”</span>
              <span class="sdk-session-id" id="sdk-session-2" title="Session ID"></span>
              <span class="pane-status" id="status-2">Ready</span>
              <span class="agent-health" id="health-2" title="Last output time">-</span>
              <span class="stuck-indicator" id="stuck-2" title="Agent may be stuck">⚠</span>
              <span class="delivery-indicator" id="delivery-2" title="Message delivery status"></span>
              <div class="pane-actions">
                <button class="pane-action-btn interrupt-btn" data-pane-id="2" title="Send Ctrl+C (interrupt)">⊘</button>
                <button class="pane-action-btn unstick-btn" data-pane-id="2" title="Send ESC (unstick)">⎋</button>
              </div>
              <button class="pane-refresh-btn" data-pane-id="2" title="Refresh context">↻</button>
            </div>
          </div>
          <div class="pane-terminal" id="terminal-2"></div>
        </div>

        <div class="pane" data-pane-id="3">
          <div class="pane-header">
            <span class="pane-title"><span class="agent-avatar">ðŸ”§</span><span class="agent-badge idle" id="badge-3"></span>Implementer A<span class="cli-badge" id="cli-badge-3"></span><span class="pane-project" id="project-3" title="Click to change project"></span><span class="agent-task" id="task-3"></span></span>
            <div class="pane-header-right">
              <span class="pane-timer" id="timer-3" title="Session time">0:00</span>
              <span class="sdk-status disconnected" id="sdk-status-3" title="SDK session status">â€”</span>
              <span class="sdk-session-id" id="sdk-session-3" title="Session ID"></span>
              <span class="pane-status" id="status-3">Ready</span>
              <span class="agent-health" id="health-3" title="Last output time">-</span>
              <span class="stuck-indicator" id="stuck-3" title="Agent may be stuck">⚠</span>
              <span class="delivery-indicator" id="delivery-3" title="Message delivery status"></span>
              <div class="pane-actions">
                <button class="pane-action-btn interrupt-btn" data-pane-id="3" title="Send Ctrl+C (interrupt)">⊘</button>
                <button class="pane-action-btn unstick-btn" data-pane-id="3" title="Send ESC (unstick)">⎋</button>
              </div>
              <button class="pane-refresh-btn" data-pane-id="3" title="Refresh context">↻</button>
            </div>
          </div>
          <div class="pane-terminal" id="terminal-3"></div>
        </div>

        <div class="pane" data-pane-id="4">
          <div class="pane-header">
            <span class="pane-title"><span class="agent-avatar">âš™ï¸</span><span class="agent-badge idle" id="badge-4"></span>Implementer B<span class="cli-badge" id="cli-badge-4"></span><span class="pane-project" id="project-4" title="Click to change project"></span><span class="agent-task" id="task-4"></span></span>
            <div class="pane-header-right">
              <span class="pane-timer" id="timer-4" title="Session time">0:00</span>
              <span class="sdk-status disconnected" id="sdk-status-4" title="SDK session status">â€”</span>
              <span class="sdk-session-id" id="sdk-session-4" title="Session ID"></span>
              <span class="pane-status" id="status-4">Ready</span>
              <span class="agent-health" id="health-4" title="Last output time">-</span>
              <span class="stuck-indicator" id="stuck-4" title="Agent may be stuck">⚠</span>
              <span class="delivery-indicator" id="delivery-4" title="Message delivery status"></span>
              <div class="pane-actions">
                <button class="pane-action-btn interrupt-btn" data-pane-id="4" title="Send Ctrl+C (interrupt)">⊘</button>
                <button class="pane-action-btn unstick-btn" data-pane-id="4" title="Send ESC (unstick)">⎋</button>
              </div>
              <button class="pane-refresh-btn" data-pane-id="4" title="Refresh context">↻</button>
            </div>
          </div>
          <div class="pane-terminal" id="terminal-4"></div>
        </div>

        <div class="pane" data-pane-id="5">
          <div class="pane-header">
            <span class="pane-title"><span class="agent-avatar">ðŸ”</span><span class="agent-badge idle" id="badge-5"></span>Investigator<span class="cli-badge" id="cli-badge-5"></span><span class="pane-project" id="project-5" title="Click to change project"></span><span class="agent-task" id="task-5"></span></span>
            <div class="pane-header-right">
              <span class="pane-timer" id="timer-5" title="Session time">0:00</span>
              <span class="sdk-status disconnected" id="sdk-status-5" title="SDK session status">â€”</span>
              <span class="sdk-session-id" id="sdk-session-5" title="Session ID"></span>
              <span class="pane-status" id="status-5">Ready</span>
              <span class="agent-health" id="health-5" title="Last output time">-</span>
              <span class="stuck-indicator" id="stuck-5" title="Agent may be stuck">⚠</span>
              <span class="delivery-indicator" id="delivery-5" title="Message delivery status"></span>
              <div class="pane-actions">
                <button class="pane-action-btn interrupt-btn" data-pane-id="5" title="Send Ctrl+C (interrupt)">⊘</button>
                <button class="pane-action-btn unstick-btn" data-pane-id="5" title="Send ESC (unstick)">⎋</button>
              </div>
              <button class="pane-refresh-btn" data-pane-id="5" title="Refresh context">↻</button>
            </div>
          </div>
          <div class="pane-terminal" id="terminal-5"></div>
        </div>

        <div class="pane" data-pane-id="6">
          <div class="pane-header">
            <span class="pane-title"><span class="agent-avatar">âœ…</span><span class="agent-badge idle" id="badge-6"></span>Reviewer<span class="cli-badge" id="cli-badge-6"></span><span class="pane-project" id="project-6" title="Click to change project"></span><span class="agent-task" id="task-6"></span></span>
            <div class="pane-header-right">
              <span class="pane-timer" id="timer-6" title="Session time">0:00</span>
              <span class="sdk-status disconnected" id="sdk-status-6" title="SDK session status">â€”</span>
              <span class="sdk-session-id" id="sdk-session-6" title="Session ID"></span>
              <span class="pane-status" id="status-6">Ready</span>
              <span class="agent-health" id="health-6" title="Last output time">-</span>
              <span class="stuck-indicator" id="stuck-6" title="Agent may be stuck">⚠</span>
              <span class="delivery-indicator" id="delivery-6" title="Message delivery status"></span>
              <div class="pane-actions">
                <button class="pane-action-btn interrupt-btn" data-pane-id="6" title="Send Ctrl+C (interrupt)">⊘</button>
                <button class="pane-action-btn unstick-btn" data-pane-id="6" title="Send ESC (unstick)">⎋</button>
              </div>
              <button class="pane-refresh-btn" data-pane-id="6" title="Refresh context">↻</button>
            </div>
          </div>
          <div class="pane-terminal" id="terminal-6"></div>
        </div>

        <!-- Input bar is now inside the grid, under the agent panes -->
        <form class="broadcast-bar" autocomplete="off" onsubmit="return false;">
          <input type="text" class="broadcast-input" id="broadcastInput"
                 placeholder="Type here to message Architect (Enter to send)"
                 title="Send message to Architect"
                 autocomplete="new-password" autocorrect="off" autocapitalize="off"
                 spellcheck="false" data-lpignore="true" data-form-type="other"
                 data-1p-ignore="true" list=""
                 name="broadcast-input-random-8472"
                 readonly onfocus="this.removeAttribute('readonly');">
          <button type="button" class="btn" id="broadcastBtn" title="Send message to Architect">Send</button>
        </form>
      </div>
    </div>

    <div class="right-panel" id="rightPanel">
      <div class="panel-tabs">
        <button class="panel-tab active" data-tab="screenshots" title="Drag & drop images for agents to reference">Shots</button>
        <button class="panel-tab" data-tab="tests" title="View test results and run test suite">Tests</button>
        <button class="panel-tab" data-tab="activity" title="Real-time log of all agent activity">Activity</button>
        <button class="panel-tab" data-tab="inspector" title="Debug message flow and delivery">Insp</button>
        <button class="panel-tab" data-tab="history" title="View past session history">Hist</button>
        <button class="panel-tab" data-tab="projects" title="Quick-switch between recent projects">Proj</button>
        <button class="panel-tab" data-tab="performance" title="Agent performance metrics and stats">Perf</button>
        <button class="panel-tab" data-tab="templates" title="Save and load workspace configurations">Tmpl</button>
        <button class="panel-tab" data-tab="progress" title="Build progress and usage statistics">Prog</button>
        <button class="panel-tab" data-tab="processes" title="Manage background processes">Proc</button>
        <button class="panel-tab" data-tab="messages" title="View message history between agents">Msgs</button>
      </div>
      <div class="panel-content">
        <div class="tab-pane active" id="tab-screenshots">
          <div class="tab-title">Screenshots</div>
          <div class="tab-description">Drag & drop images or paste from clipboard</div>
          <div class="screenshot-dropzone" id="screenshotDropzone">
            <div class="screenshot-dropzone-icon">ðŸ“·</div>
            <div class="screenshot-dropzone-text">Drop images here or click to browse</div>
          </div>
          <div class="screenshot-list" id="screenshotList">
            <div class="screenshot-empty">No screenshots yet</div>
          </div>
        </div>
        <div class="tab-pane" id="tab-tests">
          <div class="tab-title">Test Results</div>
          <div class="tab-description">View test execution results and failures</div>
          <div class="test-status-badge idle" id="testStatusBadge">No tests run</div>
          <div class="test-summary" id="testSummary">
            <div class="test-summary-card passed">
              <div class="test-summary-value" id="testPassedCount">0</div>
              <div class="test-summary-label">Passed</div>
            </div>
            <div class="test-summary-card failed">
              <div class="test-summary-value" id="testFailedCount">0</div>
              <div class="test-summary-label">Failed</div>
            </div>
            <div class="test-summary-card skipped">
              <div class="test-summary-value" id="testSkippedCount">0</div>
              <div class="test-summary-label">Skipped</div>
            </div>
          </div>
          <div class="test-progress-bar">
            <div class="test-progress-fill" id="testProgressFill">
              <div class="test-progress-passed" id="testProgressPassed" style="width: 0%"></div>
              <div class="test-progress-failed" id="testProgressFailed" style="width: 0%"></div>
              <div class="test-progress-skipped" id="testProgressSkipped" style="width: 0%"></div>
            </div>
          </div>
          <div class="test-results-list" id="testResultsList">
            <div class="test-empty">No test results yet. Run tests to see results here.</div>
          </div>
          <div class="test-actions">
            <button class="btn btn-test" id="runTestsBtn" title="Execute test suite for current project">Run Tests</button>
            <button class="btn" id="refreshTestsBtn" title="Reload test results from last run">Refresh</button>
            <button class="btn" id="clearTestsBtn" title="Clear all test results">Clear</button>
          </div>
        </div>
        <div class="tab-pane" id="tab-activity">
          <div class="tab-title">Activity Log</div>
          <div class="tab-description">Real-time agent activity and events</div>
          <div class="activity-controls">
            <div class="activity-filters">
              <button class="activity-filter active" data-filter="all">All</button>
              <button class="activity-filter" data-filter="error">Errors</button>
              <button class="activity-filter" data-filter="file" title="Show file change events">Files</button>
              <button class="activity-filter" data-filter="state" title="Show state transition events">State</button>
            </div>
            <input type="text" class="activity-search" id="activitySearch" placeholder="Search..." title="Filter activity by text" autocomplete="off">
          </div>
          <div class="activity-log" id="activityLog">
            <div class="activity-empty">No activity yet</div>
          </div>
          <div class="activity-actions">
            <button class="btn" id="clearActivityBtn" title="Clear all activity entries">Clear</button>
            <button class="btn" id="exportActivityBtn" title="Download activity log as text file">Export</button>
          </div>
        </div>
        <div class="tab-pane" id="tab-history">
          <div class="tab-title">Session History</div>
          <div class="tab-description">Past agent sessions and their durations</div>
          <div class="history-list" id="historyList">
            <div class="history-empty">No sessions recorded yet</div>
          </div>
          <div class="history-actions">
            <button class="btn" id="refreshHistoryBtn" title="Reload session history">Refresh</button>
          </div>
        </div>
        <div class="tab-pane" id="tab-projects">
          <div class="tab-title">Recent Projects</div>
          <div class="tab-description">Quick-switch between projects</div>
          <div class="projects-list" id="projectsList">
            <div class="projects-empty">No recent projects</div>
          </div>
          <div class="projects-actions">
            <button class="btn btn-folder" id="addProjectBtn" title="Browse for a new project folder">Add Project</button>
            <button class="btn" id="refreshProjectsBtn" title="Reload recent projects list">Refresh</button>
          </div>
        </div>
        <div class="tab-pane" id="tab-performance">
          <div class="tab-title">Agent Performance</div>
          <div class="tab-description">Track agent completions and response times</div>
          <div class="perf-grid" id="perfGrid">
            <div class="perf-card" data-pane="1">
              <div class="perf-card-header">Architect</div>
              <div class="perf-stat"><span class="perf-value" id="perf-completions-1">0</span><span class="perf-label">Completions</span></div>
              <div class="perf-stat"><span class="perf-value" id="perf-avgtime-1">--</span><span class="perf-label">Avg Time</span></div>
              <div class="perf-stat"><span class="perf-value" id="perf-success-1">--</span><span class="perf-label">Success</span></div>
            </div>
            <div class="perf-card" data-pane="2">
              <div class="perf-card-header">Orchestrator</div>
              <div class="perf-stat"><span class="perf-value" id="perf-completions-2">0</span><span class="perf-label">Completions</span></div>
              <div class="perf-stat"><span class="perf-value" id="perf-avgtime-2">--</span><span class="perf-label">Avg Time</span></div>
              <div class="perf-stat"><span class="perf-value" id="perf-success-2">--</span><span class="perf-label">Success</span></div>
            </div>
            <div class="perf-card" data-pane="3">
              <div class="perf-card-header">Implementer A</div>
              <div class="perf-stat"><span class="perf-value" id="perf-completions-3">0</span><span class="perf-label">Completions</span></div>
              <div class="perf-stat"><span class="perf-value" id="perf-avgtime-3">--</span><span class="perf-label">Avg Time</span></div>
              <div class="perf-stat"><span class="perf-value" id="perf-success-3">--</span><span class="perf-label">Success</span></div>
            </div>
            <div class="perf-card" data-pane="4">
              <div class="perf-card-header">Implementer B</div>
              <div class="perf-stat"><span class="perf-value" id="perf-completions-4">0</span><span class="perf-label">Completions</span></div>
              <div class="perf-stat"><span class="perf-value" id="perf-avgtime-4">--</span><span class="perf-label">Avg Time</span></div>
              <div class="perf-stat"><span class="perf-value" id="perf-success-4">--</span><span class="perf-label">Success</span></div>
            </div>
            <div class="perf-card" data-pane="5">
              <div class="perf-card-header">Investigator</div>
              <div class="perf-stat"><span class="perf-value" id="perf-completions-5">0</span><span class="perf-label">Completions</span></div>
              <div class="perf-stat"><span class="perf-value" id="perf-avgtime-5">--</span><span class="perf-label">Avg Time</span></div>
              <div class="perf-stat"><span class="perf-value" id="perf-success-5">--</span><span class="perf-label">Success</span></div>
            </div>
            <div class="perf-card" data-pane="6">
              <div class="perf-card-header">Reviewer</div>
              <div class="perf-stat"><span class="perf-value" id="perf-completions-6">0</span><span class="perf-label">Completions</span></div>
              <div class="perf-stat"><span class="perf-value" id="perf-avgtime-6">--</span><span class="perf-label">Avg Time</span></div>
              <div class="perf-stat"><span class="perf-value" id="perf-success-6">--</span><span class="perf-label">Success</span></div>
            </div>
          </div>
          <div class="perf-actions">
            <button class="btn" id="refreshPerfBtn" title="Reload performance statistics">Refresh</button>
            <button class="btn btn-danger" id="resetPerfBtn" title="Clear all performance data">Reset Stats</button>
          </div>
        </div>
        <div class="tab-pane" id="tab-templates">
          <div class="tab-title">Agent Templates</div>
          <div class="tab-description">Save and load agent configurations</div>
          <div class="template-current">
            <div class="template-section-title">Current Configuration</div>
            <div class="template-save-form">
              <input type="text" class="template-input" id="templateNameInput" placeholder="Template name..." title="Enter a name for this configuration" autocomplete="off">
              <button class="btn btn-folder" id="saveTemplateBtn" title="Save current settings as a template">Save</button>
            </div>
          </div>
          <div class="template-list" id="templateList">
            <div class="template-empty">No saved templates</div>
          </div>
          <div class="template-actions">
            <button class="btn" id="refreshTemplatesBtn" title="Reload template list">Refresh</button>
          </div>
        </div>
        <div class="tab-pane" id="tab-progress">
          <div class="tab-title">Build Progress</div>
          <div class="tab-description">Track task completion and checkpoints</div>

          <div class="progress-section">
            <div class="progress-label">Current State</div>
            <div class="progress-state-badge" id="progressState">IDLE</div>
          </div>

          <div class="progress-section">
            <div class="progress-label">Checkpoints</div>
            <div class="progress-checkpoints">
              <div class="checkpoint-bar">
                <div class="checkpoint-fill" id="checkpointFill" style="width: 0%"></div>
              </div>
              <span class="checkpoint-text" id="checkpointText">0 / 0</span>
            </div>
          </div>

          <div class="progress-section">
            <div class="progress-label">Active Agents</div>
            <div class="active-agents-list" id="activeAgentsList">
              <span class="no-agents">No agents active</span>
            </div>
          </div>

          <div class="progress-section">
            <div class="progress-label">Friction Count</div>
            <div class="friction-count-display" id="frictionCountDisplay">0</div>
          </div>

          <div class="progress-section usage-stats-section">
            <div class="progress-label">Usage Stats (Cost Tracking)</div>
            <div class="usage-stats-grid" id="usageStatsGrid">
              <div class="usage-stat">
                <span class="usage-stat-value" id="usageTotalSpawns">0</span>
                <span class="usage-stat-label">Total Spawns</span>
              </div>
              <div class="usage-stat">
                <span class="usage-stat-value" id="usageSessionsToday">0</span>
                <span class="usage-stat-label">Sessions Today</span>
              </div>
              <div class="usage-stat">
                <span class="usage-stat-value" id="usageTotalTime">0s</span>
                <span class="usage-stat-label">Total Time</span>
              </div>
              <div class="usage-stat cost-estimate">
                <span class="usage-stat-value" id="usageEstCost">$0.00</span>
                <span class="usage-stat-label">Est. Cost</span>
              </div>
            </div>
          </div>

          <div class="progress-section" id="errorSection" style="display: none;">
            <div class="progress-label">Last Error</div>
            <div class="error-display" id="errorDisplay"></div>
          </div>

          <div class="progress-actions">
            <button class="btn" id="refreshProgressBtn" title="Reload build progress and stats">Refresh</button>
          </div>
        </div>
        <div class="tab-pane" id="tab-processes">
          <div class="tab-title">Processes</div>
          <div class="tab-description">Manage background processes (npm run dev, tsc --watch, etc.)</div>
          <div class="process-spawn-form">
            <input type="text" class="process-input" id="processCommandInput" placeholder="npm run dev" title="Enter command to run (e.g., npm run dev, tsc --watch)" autocomplete="off">
            <button class="process-spawn-btn" id="processSpawnBtn" title="Start the background process">Start</button>
          </div>
          <div class="process-list" id="processList">
            <div class="process-empty">No processes running</div>
          </div>
        </div>

        <!-- MQ3+MQ6: Messages Tab -->
        <div class="tab-pane" id="tab-messages">
          <div class="tab-title">Messages</div>
          <div class="tab-description">Message history and group messaging between agents</div>

          <!-- Filter buttons -->
          <div class="messages-filter-row">
            <button class="messages-filter active" data-filter="all" title="Show all messages">All</button>
            <button class="messages-filter" data-filter="architect" title="Messages from/to Architect">Architect</button>
            <button class="messages-filter" data-filter="orchestrator" title="Messages from/to Orchestrator">Orchestrator</button>
            <button class="messages-filter" data-filter="implementer-a" title="Messages from/to Implementer A">Implementer A</button>
            <button class="messages-filter" data-filter="implementer-b" title="Messages from/to Implementer B">Implementer B</button>
            <button class="messages-filter" data-filter="investigator" title="Messages from/to Investigator">Investigator</button>
            <button class="messages-filter" data-filter="reviewer" title="Messages from/to Reviewer">Reviewer</button>
          </div>

          <!-- Message list -->
          <div class="messages-list" id="messagesList">
            <div class="messages-empty">No messages yet</div>
          </div>

          <!-- MQ6: Message Composer -->
          <div class="message-composer">
            <div class="composer-title">Send Message</div>
            <div class="composer-recipients">
              <button class="recipient-btn" data-recipient="architect" title="Send to Architect (Pane 1)">Architect</button>
              <button class="recipient-btn" data-recipient="orchestrator" title="Send to Orchestrator (Pane 2)">Orchestrator</button>
              <button class="recipient-btn" data-recipient="implementer-a" title="Send to Implementer A (Pane 3)">Implementer A</button>
              <button class="recipient-btn" data-recipient="implementer-b" title="Send to Implementer B (Pane 4)">Implementer B</button>
              <button class="recipient-btn" data-recipient="investigator" title="Send to Investigator (Pane 5)">Investigator</button>
              <button class="recipient-btn" data-recipient="reviewer" title="Send to Reviewer (Pane 6)">Reviewer</button>
              <button class="recipient-btn" data-recipient="workers" title="Send to Implementer A, Implementer B, and Investigator">Implementers + Investigator</button>
              <button class="recipient-btn" data-recipient="all" title="Send to all agents">All Agents</button>
            </div>
            <div class="composer-input-row">
              <textarea class="composer-input" id="messageComposerInput" placeholder="Type your message..." rows="2" title="Enter message to send"></textarea>
              <button class="composer-send-btn" id="messageSendBtn" title="Send message to selected recipients" disabled>Send</button>
            </div>
          </div>

          <!-- Actions -->
          <div class="messages-actions">
            <button class="btn btn-secondary" id="refreshMessagesBtn" title="Reload message history">Refresh</button>
            <button class="btn btn-secondary" id="clearMessagesBtn" title="Clear message history">Clear</button>
          </div>
        </div>

        <!-- P2-5: Message Inspector Tab -->
        <div class="tab-pane" id="tab-inspector">
          <div class="tab-title">Message Inspector</div>
          <div class="tab-description">Debug message flow, delivery status, and sequence tracking</div>

          <!-- Stats summary -->
          <div class="inspector-stats">
            <div class="inspector-stat">
              <span class="inspector-stat-value" id="inspectorTotalEvents">0</span>
              <span class="inspector-stat-label">Events</span>
            </div>
            <div class="inspector-stat success">
              <span class="inspector-stat-value" id="inspectorDelivered">0</span>
              <span class="inspector-stat-label">Delivered</span>
            </div>
            <div class="inspector-stat warning">
              <span class="inspector-stat-value" id="inspectorPending">0</span>
              <span class="inspector-stat-label">Pending</span>
            </div>
            <div class="inspector-stat error">
              <span class="inspector-stat-value" id="inspectorSkipped">0</span>
              <span class="inspector-stat-label">Skipped</span>
            </div>
          </div>

          <!-- Filter controls -->
          <div class="inspector-controls">
            <div class="inspector-filters">
              <button class="inspector-filter active" data-filter="all" title="Show all events">All</button>
              <button class="inspector-filter" data-filter="trigger" title="Trigger file events">Triggers</button>
              <button class="inspector-filter" data-filter="broadcast" title="Broadcast messages">Broadcast</button>
              <button class="inspector-filter" data-filter="sdk" title="SDK mode events">SDK</button>
              <button class="inspector-filter" data-filter="blocked" title="Blocked/skipped messages">Blocked</button>
            </div>
            <div class="inspector-toggle">
              <label class="inspector-toggle-label">
                <input type="checkbox" id="inspectorAutoScroll" checked>
                Auto-scroll
              </label>
              <label class="inspector-toggle-label">
                <input type="checkbox" id="inspectorPaused">
                Pause
              </label>
            </div>
          </div>

          <!-- Event log -->
          <div class="inspector-log" id="inspectorLog">
            <div class="inspector-empty">No events captured yet. Trigger files or send messages to see activity.</div>
          </div>

          <!-- Actions -->
          <div class="inspector-actions">
            <button class="btn" id="refreshInspectorBtn" title="Reload sequence state">Refresh State</button>
            <button class="btn" id="clearInspectorBtn" title="Clear event log">Clear Log</button>
            <button class="btn" id="exportInspectorBtn" title="Export log to file">Export</button>
          </div>

          <!-- Sequence state display -->
          <div class="inspector-section">
            <div class="inspector-section-title">Sequence Tracking State</div>
            <div class="inspector-sequence-grid" id="inspectorSequenceGrid">
              <div class="inspector-sequence-item" data-agent="lead">
                <span class="inspector-seq-name">Architect</span>
                <span class="inspector-seq-value" id="seq-lead">-</span>
              </div>
              <div class="inspector-sequence-item" data-agent="orchestrator">
                <span class="inspector-seq-name">Orchestrator</span>
                <span class="inspector-seq-value" id="seq-orchestrator">-</span>
              </div>
              <div class="inspector-sequence-item" data-agent="worker-a">
                <span class="inspector-seq-name">Implementer A</span>
                <span class="inspector-seq-value" id="seq-worker-a">-</span>
              </div>
              <div class="inspector-sequence-item" data-agent="worker-b">
                <span class="inspector-seq-name">Implementer B</span>
                <span class="inspector-seq-value" id="seq-worker-b">-</span>
              </div>
              <div class="inspector-sequence-item" data-agent="investigator">
                <span class="inspector-seq-name">Investigator</span>
                <span class="inspector-seq-value" id="seq-investigator">-</span>
              </div>
              <div class="inspector-sequence-item" data-agent="reviewer">
                <span class="inspector-seq-name">Reviewer</span>
                <span class="inspector-seq-value" id="seq-reviewer">-</span>
              </div>
            </div>
          </div>

          <!-- Task #8: Reliability Analytics Section -->
          <div class="inspector-section">
            <div class="inspector-section-title">Reliability Analytics</div>
            <div class="reliability-overview">
              <div class="reliability-stat primary">
                <span class="reliability-stat-value" id="reliabilitySuccessRate">--%</span>
                <span class="reliability-stat-label">Success Rate</span>
              </div>
              <div class="reliability-stat">
                <span class="reliability-stat-value" id="reliabilityUptime">--</span>
                <span class="reliability-stat-label">Uptime</span>
              </div>
              <div class="reliability-stat">
                <span class="reliability-stat-value" id="reliabilityLatency">--ms</span>
                <span class="reliability-stat-label">Avg Latency</span>
              </div>
            </div>
            <div class="reliability-details">
              <div class="reliability-row">
                <span class="reliability-row-label">Total Sent:</span>
                <span class="reliability-row-value" id="reliabilitySent">0</span>
              </div>
              <div class="reliability-row">
                <span class="reliability-row-label">Delivered:</span>
                <span class="reliability-row-value success" id="reliabilityDelivered">0</span>
              </div>
              <div class="reliability-row">
                <span class="reliability-row-label">Failed:</span>
                <span class="reliability-row-value error" id="reliabilityFailed">0</span>
              </div>
              <div class="reliability-row">
                <span class="reliability-row-label">Timed Out:</span>
                <span class="reliability-row-value warning" id="reliabilityTimedOut">0</span>
              </div>
              <div class="reliability-row">
                <span class="reliability-row-label">Skipped (dup):</span>
                <span class="reliability-row-value" id="reliabilitySkipped">0</span>
              </div>
            </div>
            <div class="reliability-modes">
              <div class="reliability-mode-card">
                <div class="reliability-mode-title">PTY Mode</div>
                <div class="reliability-mode-stats">
                  <span id="reliabilityPtySent">0</span> sent /
                  <span id="reliabilityPtyDelivered">0</span> delivered
                </div>
              </div>
              <div class="reliability-mode-card">
                <div class="reliability-mode-title">SDK Mode</div>
                <div class="reliability-mode-stats">
                  <span id="reliabilitySdkSent">0</span> sent /
                  <span id="reliabilitySdkDelivered">0</span> delivered
                </div>
              </div>
            </div>
            <div class="reliability-windows">
              <div class="reliability-window">
                <span class="reliability-window-label">Last 15m:</span>
                <span id="reliability15m">--</span>
              </div>
              <div class="reliability-window">
                <span class="reliability-window-label">Last 1h:</span>
                <span id="reliability1h">--</span>
              </div>
            </div>
            <button class="btn" id="refreshReliabilityBtn" title="Refresh reliability stats">Refresh Stats</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="status-bar">
    <span id="connectionStatus">Initializing...</span>
    <span id="heartbeatIndicator" class="heartbeat-indicator idle" style="display: none;">HB: IDLE (10m)</span>
    <span>Press Ctrl+1-6 to focus pane | Enter to send to Lead | /all to broadcast | /3 to target pane 3</span>
  </div>

  <script src="renderer.js"></script>
</body>
</html>
