<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: file:; connect-src 'self' ws://127.0.0.1:*; font-src 'self'">
  <title>Hivemind</title>
  <link rel="stylesheet" href="node_modules/@xterm/xterm/css/xterm.css">
  <link rel="stylesheet" href="styles/base.css">
  <link rel="stylesheet" href="styles/layout.css">
  <link rel="stylesheet" href="styles/panes.css">
  <link rel="stylesheet" href="styles/state-bar.css">
  <link rel="stylesheet" href="styles/settings-panel.css">
  <link rel="stylesheet" href="styles/tabs.css">
</head>
<body>
  <div class="startup-loading-overlay" id="startupLoadingOverlay" aria-live="polite">
    <div class="startup-loading-content">
      <img class="startup-loading-logo" src="assets/hivemind-icon-rounded.png" alt="Hivemind logo">
      <div class="startup-loading-spinner" aria-hidden="true"></div>
    </div>
  </div>

  <!-- Command Palette (Ctrl+K) -->
  <div class="command-palette-overlay" id="commandPaletteOverlay">
    <div class="command-palette" id="commandPalette">
      <input type="text" class="command-palette-input" id="commandPaletteInput"
             placeholder="Type a command..." autocomplete="off" spellcheck="false">
      <div class="command-palette-list" id="commandPaletteList"></div>
      <div class="command-palette-footer">
        <span class="shortcut"><kbd>↑</kbd><kbd>↓</kbd> Navigate</span>
        <span class="shortcut">Enter Select</span>
        <span class="shortcut">Esc Close</span>
      </div>
    </div>
  </div>

  <div class="header">
    <h1>Hivemind <span class="header-session-badge pending" id="headerSessionBadge" title="Current app session">Session --</span></h1>
    <span class="dry-run-indicator" id="dryRunIndicator" style="display: none;">DRY RUN</span>
    <div class="ci-status-indicator idle" id="ciStatusIndicator" style="display: none;">
      <span class="ci-status-icon" id="ciStatusIcon">-</span>
      <span class="ci-status-text" id="ciStatusText">CI Idle</span>
    </div>
    <div class="header-actions">
      <button class="btn btn-folder" id="selectProjectBtn" title="Choose project folder for all agents"><svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg> Project</button>
      <div class="dropdown" id="actionsDropdown">
        <button class="btn btn-actions" id="actionsBtn" title="Agent management actions"><svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg> Actions <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></button>
        <div class="dropdown-menu" id="actionsMenu">
          <button class="dropdown-item btn-nudge" id="nudgeAllBtn" title="Send Esc+Enter to unstick churning agents"><svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg> Nudge All</button>
          <button class="dropdown-item btn-danger" id="killAllBtn" title="Terminate all running agent sessions"><svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg> Kill All</button>
          <button class="dropdown-item btn-fresh" id="freshStartBtn" title="Kill all sessions and start fresh without context"><svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 1 1-8 0 4 4 0 0 1 8 0z"/></svg> Fresh Start</button>
          <button class="dropdown-item btn-restart" id="fullRestartBtn" title="Shutdown cleanly (run 'npm start' to restart)"><svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18.36 6.64a9 9 0 1 1-12.73 0"/><line x1="12" y1="2" x2="12" y2="12"/></svg> Shutdown</button>
        </div>
      </div>
      <button class="btn settings-btn" id="settingsBtn" title="Configure Hivemind settings and permissions"><svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg> Settings</button>
      <button class="btn btn-panel" id="panelBtn" title="Toggle right panel (Screenshots, Tests, Activity, etc.)"><svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="15" y1="3" x2="15" y2="21"/></svg> Panel</button>
    </div>
  </div>

  <div class="settings-panel" id="settingsPanel">
    <div class="settings-section">
      <div class="settings-section-title">User Profile</div>
      <div class="settings-subgrid settings-two-col">
        <div class="setting-field">
          <label class="setting-label">Your name</label>
          <input type="text" class="settings-input" data-setting="userName" placeholder="Enter name" spellcheck="false">
        </div>
        <div class="setting-field">
          <label class="setting-label">Experience level</label>
          <select class="settings-select" data-setting="userExperienceLevel">
            <option value="beginner">Beginner</option>
            <option value="intermediate">Intermediate</option>
            <option value="advanced">Advanced</option>
            <option value="expert">Expert</option>
          </select>
        </div>
      </div>
      <div class="settings-subgrid settings-two-col" style="margin-top: 0;">
        <div class="setting-field">
          <label class="setting-label">Communication style</label>
          <select class="settings-select" data-setting="userPreferredStyle">
            <option value="detailed">Detailed — thorough explanations</option>
            <option value="balanced">Balanced — standard</option>
            <option value="concise">Concise — brief and direct</option>
          </select>
        </div>
      </div>
    </div>
    <div class="settings-section">
      <div class="settings-section-title">General</div>
      <div class="settings-grid">
        <div class="setting-item" title="Automatically start agents in all panes when Hivemind launches">
          <div class="toggle" id="toggleAutoSpawn" data-setting="autoSpawn"></div>
          <span class="setting-label">Auto-spawn agents on start</span>
        </div>
        <div class="setting-item" title="Broadcast context updates to agents when workflow state changes">
          <div class="toggle" id="toggleAutoSync" data-setting="autoSync"></div>
          <span class="setting-label">Auto-sync context on state change</span>
        </div>
        <div class="setting-item" title="Play sound when agents complete tasks or encounter errors">
          <div class="toggle" id="toggleNotifications" data-setting="notifications"></div>
          <span class="setting-label">Sound notifications</span>
        </div>
        <div class="setting-item" title="Open Chrome DevTools when Hivemind starts (for debugging)">
          <div class="toggle" id="toggleDevTools" data-setting="devTools"></div>
          <span class="setting-label">Open DevTools on start</span>
        </div>
        <div class="setting-item" title="Send sync messages to agents when workflow state changes">
          <div class="toggle active" id="toggleAgentNotify" data-setting="agentNotify"></div>
          <span class="setting-label">Notify agents on state change</span>
        </div>
        <div class="setting-item" title="Watch for file changes in workspace (triggers, context updates)">
          <div class="toggle active" id="toggleWatcher" data-setting="watcherEnabled"></div>
          <span class="setting-label">File watcher enabled</span>
        </div>
        <div class="setting-item" title="Simulate agent responses without spawning real agent instances">
          <div class="toggle" id="toggleDryRun" data-setting="dryRun"></div>
          <span class="setting-label">Dry-run mode (simulate agents)</span>
        </div>
        <div class="setting-item" title="Automatically configure MCP server for each agent on spawn">
          <div class="toggle active" id="toggleMCPAutoConfig" data-setting="mcpAutoConfig"></div>
          <span class="setting-label">Auto-configure MCP on spawn</span>
        </div>
        <div class="setting-item" title="Developer Mode: agents read project instruction files directly (for working on Hivemind itself). Project Mode: agents get role identity from firmware, project instructions are respected but Hivemind protocols take priority.">
          <span class="setting-label">Operating Mode</span>
          <select class="settings-select" data-setting="operatingMode">
            <option value="developer">Developer Mode (direct instructions)</option>
            <option value="project">Project Mode (firmware + decoupled)</option>
          </select>
        </div>
      </div>
    </div>

    <div class="settings-section">
      <div class="settings-section-title">Voice Control</div>
      <div class="settings-grid">
        <div class="setting-item" title="Enable speech-to-text for the command bar">
          <div class="toggle" id="toggleVoiceInputEnabled" data-setting="voiceInputEnabled"></div>
          <span class="setting-label">Voice input</span>
        </div>
        <div class="setting-item" title="Auto-send dictation when you stop listening">
          <div class="toggle" id="toggleVoiceAutoSend" data-setting="voiceAutoSend"></div>
          <span class="setting-label">Auto-send dictation</span>
        </div>
      </div>
      <div class="settings-subgrid">
        <div class="setting-field">
          <label class="setting-label">Voice language</label>
          <input type="text" class="settings-input" data-setting="voiceLanguage" placeholder="en-US" spellcheck="false">
        </div>
      </div>
    </div>

    <div class="settings-section">
      <div class="settings-section-title">Permissions</div>
      <div class="settings-grid">
        <div class="setting-item" title="Grant all permissions without prompting (use with caution!)">
          <div class="toggle" id="toggleAllowAllPermissions" data-setting="allowAllPermissions"></div>
          <span class="setting-label">Allow All (skip prompts)</span>
        </div>
        <div class="setting-item" title="Allow agents to read files from the filesystem">
          <div class="toggle" id="toggleAllowRead" data-setting="allowRead"></div>
          <span class="setting-label">Read files</span>
        </div>
        <div class="setting-item" title="Allow agents to create and modify files">
          <div class="toggle" id="toggleAllowWrite" data-setting="allowWrite"></div>
          <span class="setting-label">Write files</span>
        </div>
        <div class="setting-item" title="Allow agents to execute shell commands (npm, git, etc.)">
          <div class="toggle" id="toggleAllowBash" data-setting="allowBash"></div>
          <span class="setting-label">Run commands</span>
        </div>
      </div>
      <div class="permissions-warning" id="permissionsWarning" style="display: none;">
        ⚠️ "Allow All" grants full access. Only use for trusted projects.
      </div>
    </div>
    <div class="settings-section">
      <div class="settings-section-title">Cost Alerts</div>
      <div class="settings-grid">
        <div class="setting-item" title="Show warning when estimated session cost exceeds threshold">
          <div class="toggle active" id="toggleCostAlertEnabled" data-setting="costAlertEnabled"></div>
          <span class="setting-label">Enable cost alerts</span>
        </div>
      </div>
      <div class="cost-threshold-setting" title="Dollar amount that triggers a cost warning">
        <label class="setting-label">Alert threshold: $</label>
        <input type="number" id="costAlertThreshold" class="threshold-input" value="5.00" min="0.01" step="0.50" title="Estimated cost limit before warning">
      </div>
    </div>
    <div class="settings-section">
      <div class="settings-section-title">External Notifications</div>
      <div class="settings-grid">
        <div class="setting-item" title="Send external notifications for alerts and completions">
          <div class="toggle" id="toggleExternalNotificationsEnabled" data-setting="externalNotificationsEnabled"></div>
          <span class="setting-label">Enable external notifications</span>
        </div>
        <div class="setting-item" title="Send alerts (watchdog, cost, errors) to external channels">
          <div class="toggle" id="toggleNotifyOnAlerts" data-setting="notifyOnAlerts"></div>
          <span class="setting-label">Alerts</span>
        </div>
        <div class="setting-item" title="Send task completion notifications to external channels">
          <div class="toggle" id="toggleNotifyOnCompletions" data-setting="notifyOnCompletions"></div>
          <span class="setting-label">Task completions</span>
        </div>
      </div>
      <div class="settings-subgrid">
        <div class="setting-field">
          <label class="setting-label">Slack webhook</label>
          <input type="text" class="settings-input" data-setting="slackWebhookUrl" placeholder="https://hooks.slack.com/..." spellcheck="false">
        </div>
        <div class="setting-field">
          <label class="setting-label">Discord webhook</label>
          <input type="text" class="settings-input" data-setting="discordWebhookUrl" placeholder="https://discord.com/api/webhooks/..." spellcheck="false">
        </div>
      </div>
      <div class="settings-subgrid">
        <div class="setting-item" title="Send notifications via SMTP email">
          <div class="toggle" id="toggleEmailNotificationsEnabled" data-setting="emailNotificationsEnabled"></div>
          <span class="setting-label">Email notifications</span>
        </div>
        <div class="setting-item" title="Use SSL/TLS for SMTP (typically port 465)">
          <div class="toggle" id="toggleSmtpSecure" data-setting="smtpSecure"></div>
          <span class="setting-label">SMTP SSL/TLS</span>
        </div>
      </div>
      <div class="settings-subgrid settings-two-col">
        <div class="setting-field">
          <label class="setting-label">SMTP host</label>
          <input type="text" class="settings-input" data-setting="smtpHost" placeholder="smtp.example.com" spellcheck="false">
        </div>
        <div class="setting-field">
          <label class="setting-label">SMTP port</label>
          <input type="number" class="settings-input settings-input-short" data-setting="smtpPort" placeholder="587" min="1" step="1">
        </div>
        <div class="setting-field">
          <label class="setting-label">SMTP user</label>
          <input type="text" class="settings-input" data-setting="smtpUser" placeholder="user@example.com" spellcheck="false">
        </div>
        <div class="setting-field">
          <label class="setting-label">SMTP password</label>
          <input type="password" class="settings-input" data-setting="smtpPass" placeholder="app password">
        </div>
        <div class="setting-field">
          <label class="setting-label">From</label>
          <input type="text" class="settings-input" data-setting="smtpFrom" placeholder="alerts@example.com" spellcheck="false">
        </div>
        <div class="setting-field">
          <label class="setting-label">To</label>
          <input type="text" class="settings-input" data-setting="smtpTo" placeholder="you@example.com, team@example.com" spellcheck="false">
        </div>
      </div>
      <div class="settings-actions">
        <button class="btn btn-sm" id="sendExternalTestBtn" title="Send a test external notification">Send test</button>
      </div>
    </div>

  </div>

  <div class="state-bar">
    <div class="state-bar-left">
      <div class="project-indicator" title="Current project folder for all agents">
        <span class="state-label">Project:</span>
        <span class="project-path no-project" id="projectPath">No project selected</span>
      </div>
    </div>
    <div class="state-bar-right">
      <span class="session-timer" id="sessionTimer" title="Session duration">Session: 0:00</span>
      <span class="cost-indicator" id="costIndicator" title="Estimated session cost"></span>
    </div>
  </div>

  <div class="main-content">
    <div class="terminals-section" id="terminalsSection">
      <div class="pane-layout">
        <div class="main-pane-container">
          <div class="pane" data-pane-id="1">
          <div class="pane-header">
            <span class="pane-title"><span class="agent-avatar"><svg class="avatar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/></svg></span><span class="agent-badge idle" id="badge-1"></span>Arch<span class="role-desc">- Your Main Point of Contact</span><span class="cli-badge" id="cli-badge-1"></span><span class="pane-project" id="project-1" title="Click to change project"></span><span class="agent-task" id="task-1"></span></span>
            <div class="pane-header-right">
              <select class="model-selector" id="model-selector-1" data-pane-id="1" title="Switch model for this pane">
                <option value="claude">Claude</option>
                <option value="codex">Codex</option>
                <option value="gemini">Gemini</option>
              </select>
              <span class="pane-status idle" id="status-1"><span class="pane-spinner"></span>Ready</span>
              <span class="agent-health" id="health-1" title="Last output time">-</span>
              <div class="pane-actions">
                <button class="pane-action-btn interrupt-btn" data-pane-id="1" data-tooltip="Interrupt (ESC)"><svg class="pane-btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/></svg></button>
                <button class="pane-action-btn unstick-btn" data-pane-id="1" data-tooltip="Enter"><svg class="pane-btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 14 4 9 9 4"/><path d="M20 20v-7a4 4 0 0 0-4-4H4"/></svg></button>
                <button class="pane-action-btn kickoff-btn" data-pane-id="1" data-tooltip="Restart agent"><svg class="pane-btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg></button>
              </div>
              <span class="lock-icon" id="lock-icon-1" data-pane-id="1" data-tooltip="Locked (click to toggle)"><svg class="pane-btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg></span>
            </div>
          </div>
          <div class="pane-terminal" id="terminal-1"></div>
          </div>
          <!-- Command bar - under pane 1 only -->
          <form class="command-bar" autocomplete="off" onsubmit="return false;">
            <textarea class="command-input" id="broadcastInput" rows="1"
                   placeholder="Type here to message Architect (Enter to send)"
                   title="Send message to Architect"
                   autocomplete="new-password" autocorrect="off" autocapitalize="off"
                   spellcheck="false" data-lpignore="true" data-form-type="other"
                   data-1p-ignore="true"
                   name="broadcast-input-random-8472"
                   readonly onfocus="this.removeAttribute('readonly');"></textarea>
            <span class="command-delivery-status" id="commandDeliveryStatus" title="Message delivery status"></span>
            <button type="button" class="btn voice-btn" id="voiceInputBtn" title="Toggle voice input"><svg class="cmd-btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg></button>
            <button type="button" class="btn send-btn" id="broadcastBtn" title="Send message"><svg class="cmd-btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></button>
          </form>
        </div>
        <div class="side-panes-container">
          <div class="pane" data-pane-id="2">
          <div class="pane-header">
            <span class="pane-title"><span class="agent-avatar"><svg class="avatar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"/><rect x="2" y="14" width="20" height="8" rx="2" ry="2"/><line x1="6" y1="6" x2="6.01" y2="6"/><line x1="6" y1="18" x2="6.01" y2="18"/></svg></span><span class="agent-badge idle" id="badge-2"></span>Builder<span class="role-desc">- Frontend, Backend, DevOps, Testing, Security</span><span class="cli-badge" id="cli-badge-2"></span><span class="pane-project" id="project-2" title="Click to change project"></span><span class="agent-task" id="task-2"></span></span>
            <div class="pane-header-right">
              <select class="model-selector" id="model-selector-2" data-pane-id="2" title="Switch model for this pane">
                <option value="claude">Claude</option>
                <option value="codex">Codex</option>
                <option value="gemini">Gemini</option>
              </select>
              <span class="pane-status idle" id="status-2"><span class="pane-spinner"></span>Ready</span>
              <span class="agent-health" id="health-2" title="Last output time">-</span>
              <div class="pane-actions">
                <button class="pane-action-btn interrupt-btn" data-pane-id="2" data-tooltip="Interrupt (ESC)"><svg class="pane-btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/></svg></button>
                <button class="pane-action-btn unstick-btn" data-pane-id="2" data-tooltip="Enter"><svg class="pane-btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 14 4 9 9 4"/><path d="M20 20v-7a4 4 0 0 0-4-4H4"/></svg></button>
                <button class="pane-action-btn kickoff-btn" data-pane-id="2" data-tooltip="Restart agent"><svg class="pane-btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg></button>
                <button class="pane-action-btn expand-btn" data-pane-id="2" data-tooltip="Expand (ESC to collapse)"><svg class="pane-btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/></svg></button>
              </div>
              <span class="lock-icon" id="lock-icon-2" data-pane-id="2" data-tooltip="Locked (click to toggle)"><svg class="pane-btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg></span>
            </div>
          </div>
          <div class="pane-terminal" id="terminal-2"></div>
        </div>

        <div class="pane" data-pane-id="5">
          <div class="pane-header">
            <span class="pane-title"><span class="agent-avatar"><svg class="avatar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></span><span class="agent-badge idle" id="badge-5"></span>Oracle<span class="role-desc">- Investigation, Docs, Benchmarks</span><span class="cli-badge" id="cli-badge-5"></span><span class="pane-project" id="project-5" title="Click to change project"></span><span class="agent-task" id="task-5"></span></span>
            <div class="pane-header-right">
              <select class="model-selector" id="model-selector-5" data-pane-id="5" title="Switch model for this pane">
                <option value="claude">Claude</option>
                <option value="codex">Codex</option>
                <option value="gemini">Gemini</option>
              </select>
              <span class="pane-status idle" id="status-5"><span class="pane-spinner"></span>Ready</span>
              <span class="agent-health" id="health-5" title="Last output time">-</span>
              <div class="pane-actions">
                <button class="pane-action-btn interrupt-btn" data-pane-id="5" data-tooltip="Interrupt (ESC)"><svg class="pane-btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/></svg></button>
                <button class="pane-action-btn unstick-btn" data-pane-id="5" data-tooltip="Enter"><svg class="pane-btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 14 4 9 9 4"/><path d="M20 20v-7a4 4 0 0 0-4-4H4"/></svg></button>
                <button class="pane-action-btn kickoff-btn" data-pane-id="5" data-tooltip="Restart agent"><svg class="pane-btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg></button>
                <button class="pane-action-btn expand-btn" data-pane-id="5" data-tooltip="Expand (ESC to collapse)"><svg class="pane-btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/></svg></button>
              </div>
              <span class="lock-icon" id="lock-icon-5" data-pane-id="5" data-tooltip="Locked (click to toggle)"><svg class="pane-btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg></span>
            </div>
          </div>
          <div class="pane-terminal" id="terminal-5"></div>
        </div>

        </div>
      </div>

    </div>

    <div class="right-panel" id="rightPanel">
      <div class="panel-tabs">
        <!-- Primary tabs (always visible) -->
        <button class="panel-tab" data-tab="bridge" data-tab-group="primary" title="System dashboard — agents, metrics, events">Bridge</button>

        <button class="panel-tab active" data-tab="screenshots" data-tab-group="primary" title="Drag & drop images for agents to reference">Screenshots</button>
        <button class="panel-tab" data-tab="oracle" data-tab-group="primary" title="AI image generation">Image Gen</button>

        <button class="panel-tab" data-tab="api-keys" data-tab-group="primary" title="Secrets management">Secrets</button>
      </div>
      <div class="panel-content">
        <div class="tab-pane" id="tab-bridge">
          <div class="tab-title">Bridge</div>
          <div class="tab-description">Agent status, system metrics, event stream</div>
          <div class="bridge-agents" id="bridgeAgents"></div>
          <div class="bridge-metrics" id="bridgeMetrics"></div>
          <div class="bridge-transport" id="bridgeTransport"></div>
          <div class="bridge-stream" id="bridgeStream">
            <div class="bridge-stream-empty">Waiting for events...</div>
          </div>
        </div>
        <div class="tab-pane active" id="tab-screenshots">
          <div class="tab-title">Screenshots</div>
          <div class="tab-description">Drag & drop images or paste from clipboard</div>
          <div class="screenshot-dropzone" id="screenshotDropzone">
            <div class="screenshot-dropzone-icon"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="12" cy="13" r="3"/><path d="M5 3v2"/><path d="M19 3v2"/></svg></div>
            <div class="screenshot-dropzone-text">Drop images here or click to browse</div>
          </div>
          <div class="screenshot-list" id="screenshotList">
            <div class="screenshot-empty">No screenshots yet</div>
          </div>
        </div>
        <div class="tab-pane" id="tab-oracle">
          <div class="tab-title">Image Generation</div>
          <div class="tab-description">Generate images with AI</div>

          <div class="oracle-controls">
            <textarea id="oraclePromptInput"
                      class="oracle-prompt-input"
                      rows="3"
                      placeholder="Describe the image you want to generate..."></textarea>
            <div class="oracle-options">
              <div class="oracle-option">
                <label class="oracle-option-label">Style</label>
                <select id="oracleStyleSelect" class="oracle-select">
                  <option value="realistic_image">Realistic</option>
                  <option value="digital_illustration">Digital Illustration</option>
                  <option value="vector_illustration">Vector</option>
                </select>
              </div>
              <div class="oracle-option">
                <label class="oracle-option-label">Size</label>
                <select id="oracleSizeSelect" class="oracle-select">
                  <option value="1024x1024">Square (1024x1024)</option>
                  <option value="1365x1024">Landscape (1365x1024)</option>
                  <option value="1024x1365">Portrait (1024x1365)</option>
                </select>
              </div>
            </div>
            <button class="btn btn-primary" id="oracleGenerateBtn" title="Generate image">
              <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
              </svg> Generate
            </button>
          </div>

          <div class="oracle-results" id="oracleResults">
            <div class="oracle-empty">Enter a prompt and click Generate to create an image</div>
          </div>

          <div class="oracle-gallery" id="oracleGallery">
            <div class="oracle-gallery-title">All Images</div>
            <div class="oracle-gallery-list" id="oracleGalleryList">
              <div class="oracle-gallery-empty">No images yet</div>
            </div>
          </div>
        </div>
        <div class="tab-pane" id="tab-api-keys">
          <div class="tab-title">Secrets</div>
          <div class="tab-description">Manage API keys and service credentials</div>
          <div class="api-keys-grid">
            <div class="api-keys-field">
              <label class="api-keys-label">Anthropic (Claude)</label>
              <div class="api-keys-input-row">
                <input type="password" class="api-keys-input" id="apiKeyAnthropic"
                       placeholder="sk-ant-..." autocomplete="off" spellcheck="false">
                <span class="api-keys-mask" id="apiKeyAnthropicMask">Not set</span>
              </div>
            </div>
            <div class="api-keys-field">
              <label class="api-keys-label">OpenAI (Codex / Image Gen)</label>
              <div class="api-keys-input-row">
                <input type="password" class="api-keys-input" id="apiKeyOpenai"
                       placeholder="sk-..." autocomplete="off" spellcheck="false">
                <span class="api-keys-mask" id="apiKeyOpenaiMask">Not set</span>
              </div>
            </div>
            <div class="api-keys-field">
              <label class="api-keys-label">Google (Gemini)</label>
              <div class="api-keys-input-row">
                <input type="password" class="api-keys-input" id="apiKeyGoogle"
                       placeholder="AIza..." autocomplete="off" spellcheck="false">
                <span class="api-keys-mask" id="apiKeyGoogleMask">Not set</span>
              </div>
            </div>
            <div class="api-keys-field">
              <label class="api-keys-label">Recraft (Image Gen)</label>
              <div class="api-keys-input-row">
                <input type="password" class="api-keys-input" id="apiKeyRecraft"
                       placeholder="Recraft API key" autocomplete="off" spellcheck="false">
                <span class="api-keys-mask" id="apiKeyRecraftMask">Not set</span>
              </div>
            </div>
          </div>
          <div class="api-keys-section-header" id="twilioSectionToggle" style="cursor: pointer; padding: 8px 0; font-weight: 600; color: var(--text-secondary); user-select: none;">
            <span class="api-keys-section-arrow" style="margin-right: 6px; display: inline-block; transition: transform 0.2s;">&#9654;</span> Twilio SMS
          </div>
          <div class="api-keys-section-content" id="twilioSectionContent" style="display: none;">
            <div class="api-keys-field">
              <label class="api-keys-label">Twilio Account SID</label>
              <div class="api-keys-input-row">
                <input type="password" class="api-keys-input" id="apiKeyTwilioSid"
                       placeholder="Twilio Account SID (starts with AC)" autocomplete="off" spellcheck="false">
                <span class="api-keys-mask" id="apiKeyTwilioSidMask">Not set</span>
              </div>
            </div>
            <div class="api-keys-field">
              <label class="api-keys-label">Twilio Auth Token</label>
              <div class="api-keys-input-row">
                <input type="password" class="api-keys-input" id="apiKeyTwilioAuth"
                       placeholder="Twilio Auth Token" autocomplete="off" spellcheck="false">
                <span class="api-keys-mask" id="apiKeyTwilioAuthMask">Not set</span>
              </div>
            </div>
            <div class="api-keys-field">
              <label class="api-keys-label">Twilio Phone Number</label>
              <div class="api-keys-input-row">
                <input type="text" class="api-keys-input" id="apiKeyTwilioPhone"
                       placeholder="+1xxxxxxxxxx (your Twilio number)" autocomplete="off" spellcheck="false">
                <span class="api-keys-mask" id="apiKeyTwilioPhoneMask">Not set</span>
              </div>
            </div>
            <div class="api-keys-field">
              <label class="api-keys-label">SMS Recipient</label>
              <div class="api-keys-input-row">
                <input type="text" class="api-keys-input" id="apiKeySmsRecipient"
                       placeholder="+1xxxxxxxxxx (your phone number)" autocomplete="off" spellcheck="false">
                <span class="api-keys-mask" id="apiKeySmsRecipientMask">Not set</span>
              </div>
            </div>
          </div>
          <div class="api-keys-section-header" id="telegramSectionToggle" style="cursor: pointer; padding: 8px 0; font-weight: 600; color: var(--text-secondary); user-select: none;">
            <span class="api-keys-section-arrow" style="margin-right: 6px; display: inline-block; transition: transform 0.2s;">&#9654;</span> Telegram Bot
          </div>
          <div class="api-keys-section-content" id="telegramSectionContent" style="display: none;">
            <div class="api-keys-field">
              <label class="api-keys-label">Bot Token</label>
              <div class="api-keys-input-row">
                <input type="password" class="api-keys-input" id="apiKeyTelegramToken"
                       placeholder="Bot token from @BotFather" autocomplete="off" spellcheck="false">
                <span class="api-keys-mask" id="apiKeyTelegramTokenMask">Not set</span>
              </div>
            </div>
            <div class="api-keys-field">
              <label class="api-keys-label">Chat ID</label>
              <div class="api-keys-input-row">
                <input type="text" class="api-keys-input" id="apiKeyTelegramChatId"
                       placeholder="Your Telegram chat ID" autocomplete="off" spellcheck="false">
                <span class="api-keys-mask" id="apiKeyTelegramChatIdMask">Not set</span>
              </div>
            </div>
          </div>
          <div class="api-keys-actions">
            <button class="btn btn-primary btn-sm" id="saveApiKeysBtn" title="Save secrets to .env file">Save Keys</button>
            <span class="api-keys-status" id="apiKeyStatus"></span>
          </div>
          <div class="api-keys-info">Keys stored in .env (gitignored). Active immediately after save.</div>
        </div>
      </div>
    </div>
  </div>

  <div class="status-bar">
    <span id="connectionStatus">Initializing...</span>
    <span class="voice-status" id="voiceStatus" title="Voice input status"></span>
    <span id="heartbeatIndicator" class="heartbeat-indicator idle" style="display: none;">HB: IDLE (10m)</span>
    <span>Press Ctrl+1-4 to focus pane | Enter to send to Architect | Use /task to auto-route</span>
  </div>

  <script src="renderer.js"></script>
</body>
</html>
