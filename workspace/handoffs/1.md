## Architect Handoff — Session 159
Updated: 2026-02-17

### Completed This Session (17 commits)

**Memory/Handoff System (carried from context):**
- Context compressor overhaul: reads handoff files, no circular self-reference (041595d)
- WATCHED_FILES auto-refresh for handoffs + app-status (5d39f5c)

**P1 Fixes — Developer Mode / External Projects:**
- CWD isolation bypass fix in PTY create (25ac96d)
- Firmware fallback project-mode aware (624eb5a)
- Project-handlers test coverage (2964b74)
- app-status.json path mismatch → resolveCoordPath (1096d57)
- Context injection staleness → snapshot fallback (93771af)
- Context compressor dynamic coord paths for snapshots/handoffs (4f89765)
- Experiment runtime/profile paths → dynamic per project root (055b21e)

**P2 Fixes — Codex Stuck Messages:**
- Codex Enter timing: scaled delay for payload size + recovery sweeper uses nudgePane (a8b3273)
- Codex verifySubmitAccepted disabled — was causing 1200ms lag (390e6f3)
- Codex exec prompt (buildCodexExecPrompt) now called during injection (7b9f1f4)

**P3 Backlog — All Cleared:**
- link.json dead path fixed (650ee4c)
- hm-send project context metadata (63fe561)
- Evidence Ledger + Team Memory project scoping (4041e8d)
- State separation audit + experiment/websocket scoping (8795de8)
- hm-send session_id from link.json (2f0e9d3)

**Review Cycle:**
- Oracle + Builder independent adversarial reviews completed
- Oracle flagged massive IPC handler path staleness — VERIFIED as over-scoped
  - WORKSPACE_PATH is immutable constant (config.js:27), never changes at runtime
  - Hivemind-internal state (templates, knowledge, metrics, logs) correctly uses WORKSPACE_PATH
  - Project-scoped coordination state (handoffs, app-status, evidence-ledger) already fixed
- All review findings addressed and committed

### Key Decisions
- Stuck message recovery uses nudgePane() (simple PTY write) — more reliable than DOM dispatch
- Stuck messages affect ALL CLIs, not just Codex — 20-min timeout → screenshot check protocol
- WORKSPACE_PATH is global/immutable; resolveCoordPath() for project-scoped paths only
- Handoff files are git-tracked, context compressor reads but NEVER overwrites them

### Pending
- No open P1/P2/P3 items from this session's review cycle
- Future consideration: if project-scoping expands, audit which "global" state should become per-project

**Startup Continuity Fix (90ca50b):**
- All model shims (CLAUDE.md, CODEX.md, GEMINI.md) now have handoff read as first startup action
- ROLES.md worker baseline updated to include handoff read step

**Auto-Injection Purge (f524879):**
- Deleted context-injection.js and its test file — wall of text startup injection removed permanently
- All wiring removed: hivemind-app, model-switch-handlers, pty-handlers, preload/renderer
- inject-message IPC infrastructure kept (used by triggers, recovery, nudge, task pool)
- User directive: NEVER bring this back

Tests: 3157 passing across 158 suites
All 20 commits pushed to remote (f524879 is HEAD)
